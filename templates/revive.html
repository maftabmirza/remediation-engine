{% extends "layout.html" %}
{% set active_page = 'revive' %}

{% block title %}RE-VIVE Unified Assistant - AIOps Platform{% endblock %}

{% block breadcrumbs %}
<span class="mx-2">/</span>
<span class="text-gray-200 truncate">RE-VIVE Assistant</span>
{% endblock %}

{% block header_title %}
<i class="fas fa-brain text-purple-400"></i>
<span class="text-sm font-semibold text-white tracking-tight">RE-VIVE Unified Assistant</span>
{% endblock %}

{% block content %}
<style>
    .mode-badge {
        transition: all 0.3s ease;
        animation: fadeIn 0.3s ease-in;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(-5px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .mode-grafana {
        background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
    }

    .mode-aiops {
        background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
    }

    .mode-auto {
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    }

    .tool-indicator {
        animation: slideIn 0.2s ease-out;
    }

    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateX(-10px);
        }

        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    .message-bubble {
        animation: messageSlide 0.3s ease-out;
    }

    @keyframes messageSlide {
        from {
            opacity: 0;
            transform: translateY(10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .typing-indicator span {
        animation: typing 1.4s infinite;
    }

    .typing-indicator span:nth-child(2) {
        animation-delay: 0.2s;
    }

    .typing-indicator span:nth-child(3) {
        animation-delay: 0.4s;
    }

    @keyframes typing {

        0%,
        60%,
        100% {
            opacity: 0.3;
        }

        30% {
            opacity: 1;
        }
    }
</style>

<div class="h-full flex flex-col bg-gray-900">
    <!-- Header with Mode Indicator -->
    <div class="flex items-center justify-between p-4 bg-gray-800 border-b border-gray-700">
        <div class="flex items-center gap-3">
            <h1 class="text-xl font-bold text-white">RE-VIVE Assistant</h1>
            <span id="mode-badge" class="mode-badge px-3 py-1 rounded-full text-xs font-semibold text-white mode-auto">
                Auto Mode
            </span>
        </div>
        <div class="flex items-center gap-2">
            <!-- Session Selector -->
            <select id="session-selector"
                class="bg-gray-700 text-white text-sm rounded px-3 py-1.5 border border-gray-600 focus:border-purple-500 focus:outline-none">
                <option value="new">New Session</option>
            </select>
            <!-- Connection Status -->
            <div id="connection-status" class="flex items-center gap-2 text-sm">
                <span class="w-2 h-2 rounded-full bg-gray-500"></span>
                <span class="text-gray-400">Disconnected</span>
            </div>
        </div>
    </div>

    <!-- Messages Container -->
    <div id="messages-container" class="flex-1 overflow-y-auto p-4 space-y-4">
        <!-- Welcome Message -->
        <div class="message-bubble max-w-2xl mx-auto text-center py-8">
            <i class="fas fa-brain text-6xl text-purple-400 mb-4"></i>
            <h2 class="text-2xl font-bold text-white mb-2">Welcome to RE-VIVE</h2>
            <p class="text-gray-400">
                Your unified assistant for Grafana observability and AIOps remediation.
            </p>
            <p class="text-sm text-gray-500 mt-2">
                Ask about metrics, dashboards, or execute runbooks - I'll automatically determine the best approach.
            </p>
        </div>
    </div>

    <!-- Input Area -->
    <div class="p-4 bg-gray-800 border-t border-gray-700">
        <div class="max-w-4xl mx-auto">
            <div class="flex gap-2">
                <textarea id="message-input" rows="1"
                    class="flex-1 bg-gray-700 text-white rounded-lg px-4 py-3 border border-gray-600 focus:border-purple-500 focus:outline-none resize-none"
                    placeholder="Ask anything about observability or remediation..." maxlength="2000"></textarea>
                <button id="send-button"
                    class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-semibold transition disabled:opacity-50 disabled:cursor-not-allowed">
                    <i class="fas fa-paper-plane"></i>
                </button>
                <button id="stop-button"
                    class="hidden bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-semibold transition">
                    <i class="fas fa-stop"></i>
                </button>
            </div>
            <div class="flex items-center justify-between mt-2 text-xs text-gray-500">
                <span id="char-count">0 / 2000</span>
                <span>Press Shift+Enter for new line, Enter to send</span>
            </div>
        </div>
    </div>
</div>

<!-- Message Templates -->
<template id="user-message-template">
    <div class="message-bubble flex justify-end">
        <div class="max-w-2xl bg-purple-600 text-white rounded-lg px-4 py-3">
            <div class="message-content"></div>
        </div>
    </div>
</template>

<template id="assistant-message-template">
    <div class="message-bubble flex justify-start">
        <div class="max-w-2xl bg-gray-700 text-white rounded-lg px-4 py-3">
            <div class="flex items-start gap-3">
                <i class="fas fa-robot text-purple-400 mt-1"></i>
                <div class="flex-1">
                    <div class="message-content prose prose-invert max-w-none"></div>
                    <div class="tool-calls mt-2 space-y-1 hidden"></div>
                </div>
            </div>
        </div>
    </div>
</template>

<template id="typing-indicator-template">
    <div class="message-bubble flex justify-start" id="typing-indicator">
        <div class="max-w-2xl bg-gray-700 text-white rounded-lg px-4 py-3">
            <div class="flex items-center gap-2">
                <i class="fas fa-robot text-purple-400"></i>
                <div class="typing-indicator flex gap-1">
                    <span class="w-2 h-2 bg-purple-400 rounded-full"></span>
                    <span class="w-2 h-2 bg-purple-400 rounded-full"></span>
                    <span class="w-2 h-2 bg-purple-400 rounded-full"></span>
                </div>
            </div>
        </div>
    </div>
</template>

<template id="tool-call-template">
    <div class="tool-indicator flex items-center gap-2 text-sm text-gray-400 p-2 bg-gray-800 rounded">
        <i class="fas fa-cog fa-spin text-purple-400"></i>
        <span class="tool-name"></span>
    </div>
</template>

<script src="/static/js/revive.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
    // Initialize on load
    document.addEventListener('DOMContentLoaded', function () {
        if (typeof ReviveClient !== 'undefined') {
            const client = new ReviveClient();
            client.connect();
        }
    });
</script>
{% endblock %}